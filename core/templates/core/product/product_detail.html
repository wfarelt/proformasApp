{% extends 'core/index.html' %}

{% block title %}{{ title }}{% endblock %}

{% load static %}

{% block content %}
<div class="row">
    <div class="col-md-6 offset-md-3 mt-4">
        <div class="card border-primary shadow">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">
                    <i class="fas fa-box-open mr-2"></i> {{ producto.nombre }}
                </h3>
            </div>
            <div class="card-body">
                <p class="mb-2"><strong>Descripción:</strong> {{ producto.descripcion|default:"Sin descripción" }}</p>
                <p class="mb-2"><strong>Costo:</strong> <span class="badge badge-secondary">
                    {% if user.company.currency == 'BOB' %}
                        (Bs)
                    {% elif user.company.currency == 'USD' %}
                        ($)
                    {% endif %}
                    {{ producto.cost }}</span></p>
                <p class="mb-2"><strong>Precio:</strong> <span class="badge badge-success">
                    {% if user.company.currency == 'BOB' %}
                        (Bs)
                    {% elif user.company.currency == 'USD' %}
                        ($)
                    {% endif %}
                    {{ producto.precio }}</span></p>
                <p class="mb-2"><strong>Stock:</strong> <span class="badge badge-info">{{ producto.stock }}</span></p>
                <p class="mb-2"><strong>Ubicación:</strong> {{ producto.location|default:"No especificada" }}</p>
            </div>
            <div class="card-footer text-center">
                <a href="{% url 'product_edit' producto.id %}" class="btn btn-warning btn-sm">
                    <i class="fas fa-edit"></i> Editar
                </a>
                
                <a href="{% url 'product_list' %}" class="btn btn-secondary btn-sm">
                    <i class="fas fa-list"></i> Ver lista
                </a>
            </div>
        </div>
    </div>
</div>

<div class="card card-body mt-4">
    <h2>Historial de Precios</h2>
<table class="table table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Fecha</th>
            <th>Tipo</th>
            <th>Precio Anterior</th>
            <th>Precio Nuevo</th>
            <th>Cost</th>
            <th>Margen %</th>
            <th>Estado</th>
            <th>Creado por</th>
            <th>Aprobado por</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for ph in price_history %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ ph.created_at|date:"d/m/Y H:i" }}</td>
            <td>{{ ph.get_change_type_display }}</td>
            <td>{{ ph.old_price }}</td>
            <td>{{ ph.new_price }}</td>
            <td>{{ ph.cost_reference }}</td>
            <td>{{ ph.margin_percent }}</td>
            <td>
                {% if ph.status == 'APPROVED' %}
                    <span class="badge badge-success">{{ ph.get_status_display }}</span>
                {% elif ph.status == 'PENDING' %}
                    <span class="badge badge-warning">{{ ph.get_status_display }}</span>
                {% elif ph.status == 'REJECTED' %}
                    <span class="badge badge-danger">{{ ph.get_status_display }}</span>
                {% elif ph.status == 'EXPIRED' %}
                    <span class="badge badge-secondary">{{ ph.get_status_display }}</span>
                {% endif %}
            </td>
            <td>{{ ph.created_by.name }}</td>
            <td>
                {% if ph.approved_by %}
                    {{ ph.approved_by.name }}
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>
                {% if ph.status == 'PENDING' and user.is_admin %}
                <a href="{% url 'approve_price' ph.id %}" class="btn btn-success btn-sm">Aprobar</a>
                <a href="{% url 'reject_price' ph.id %}" class="btn btn-danger btn-sm">Rechazar</a>
                {% else %}
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="10">No hay historial de precios.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>


{% endblock %}