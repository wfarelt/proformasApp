# Generated by Django 5.0.6 on 2025-12-30 04:22

from django.db import migrations
from django.utils import timezone

def create_initial_price_history(apps, schema_editor):
    Producto = apps.get_model('core', 'Producto')
    PriceHistory = apps.get_model('core', 'ProductPriceHistory')
    User = apps.get_model('core', 'User')

    # Elegir usuario numero dos como creador y aprobador
    system_user = User.objects.get(pk=2)

    for producto in Producto.objects.all():
        PriceHistory.objects.create(
            product=producto,
            old_price=None,
            new_price=producto.precio,
            cost_reference=producto.cost,
            change_type='INITIAL',
            reason='Initial price migration',
            status='APPROVED',
            valid_from=timezone.now(),
            created_by=system_user,
            approved_by=system_user,
        )

class Migration(migrations.Migration):

    dependencies = [
        ('core', '0018_productpricehistory'),
    ]

    operations = [
        migrations.RunPython(create_initial_price_history),
    ]
